{% load static %}
{% with v=LAYOUT_VARIANT %}
<div class="container mt-5">
  {% if v == 1 %}
  <div class="card border-0 shadow">
    <div class="row no-gutters" data-dynamic-group="detail-hero">
      <div class="col-md-4" data-dyn="detail-image">
        {% if movie.img %}
        <img src="{{ movie.img.url }}" alt="{{ movie.name }}" class="img-fluid img-thumbnail" style="max-height: 300px; object-fit: contain;">
        {% else %}
        <img src="{% static 'images/placeholder.jpg' %}" alt="No image available" class="img-fluid img-thumbnail" style="max-height: 300px; object-fit: contain;">
        {% endif %}
      </div>
      <div class="col-md-8" data-dyn="detail-text">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="card-title">{{movie.name}}</h1>
            <span class="badge badge-primary p-2">{{movie.year}}</span>
          </div>
          <hr>
          <div class="movie-info mb-4">
            <div class="row" data-dynamic-group="detail-info-row">
              <div class="col-md-6">
                <p class="text-muted"><strong><i class="fas fa-film mr-2"></i>Category:</strong>
                  {% for genre in movie.genres.all %}<span class="badge badge-secondary">{{ genre.name }}</span>{% empty %}<span class="text-muted">Not categorized</span>{% endfor %}
                </p>
                <p class="text-muted"><strong><i class="fas fa-star mr-2"></i>Rating:</strong>
                  <span class="text-warning">{{ movie.rating|default:0|floatformat:"1" }}/5</span>
                </p>
              </div>
              <div class="col-md-6">
                <p class="text-muted"><strong><i class="fas fa-user mr-2"></i>Director:</strong> {{ movie.director|default:"Not specified" }}</p>
                <p class="text-muted"><strong><i class="fas fa-clock mr-2"></i>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</p>
              </div>
            </div>
          </div>
          <h5 class="card-subtitle mb-3"><i class="fas fa-info-circle mr-2"></i>Synopsis</h5>
          <p class="card-text">{{movie.desc}}</p>
          <div class="mt-4" data-dynamic-group="detail-actions">
            {% if movie.trailer_url %}<a href="{{ movie.trailer_url }}" target="_blank" class="btn btn-primary mr-2"><i class="fas fa-play-circle mr-1"></i> Watch Trailer</a>{% endif %}
            <a href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}" class="btn btn-warning mr-2"><i class="fas fa-edit mr-1"></i> Edit</a>
            <a href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}" class="btn btn-danger"><i class="fas fa-trash-alt mr-1"></i> Delete</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  {% elif v == 2 %}
  <div class="card border-0 shadow">
    <div class="row no-gutters align-items-center">
      <div class="col-md-8 order-md-2 p-3">
        <h1 class="mb-1">{{ movie.name }}</h1>
        <span class="badge badge-primary mb-3">{{ movie.year }}</span>
        <p class="mb-2 text-muted"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</p>
        <p class="mb-2 text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</p>
        <div class="mb-3">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <p>{{ movie.desc }}</p>
        <div class="mt-2">
          {% if movie.trailer_url %}<a href="{{ movie.trailer_url }}" target="_blank" class="btn btn-primary btn-sm mr-2">Trailer</a>{% endif %}
          <a href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}" class="btn btn-warning btn-sm mr-2">Edit</a>
          <a href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}" class="btn btn-danger btn-sm">Delete</a>
        </div>
      </div>
      <div class="col-md-4 order-md-1 text-center p-3">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid img-thumbnail" style="max-height:300px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid img-thumbnail" style="max-height:300px; object-fit:contain;">{% endif %}
      </div>
    </div>
  </div>

  {% elif v == 3 %}
  <div class="card shadow border-0 mb-4">
    <div class="card-body text-center">
      {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid rounded mb-3" style="max-height:360px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded mb-3" style="max-height:360px; object-fit:contain;">{% endif %}
      <h1 class="mb-2">{{ movie.name }}</h1>
      <span class="badge badge-primary mb-3">{{ movie.year }}</span>
      <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
      <p class="mb-0">{{ movie.desc }}</p>
      <div class="mt-3">
        {% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
        <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
        <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a>
      </div>
    </div>
  </div>

  {% elif v == 4 %}
  <div class="card border-0 shadow mb-4">
    <div class="row no-gutters">
      <div class="col-md-6 p-3">
        <h2 class="mb-2">{{ movie.name }}</h2>
        <p class="text-muted mb-2"><strong>Year:</strong> {{ movie.year }}</p>
        <p class="text-muted mb-2"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</p>
        <p class="text-muted mb-2"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</p>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <p class="mb-0">{{ movie.desc }}</p>
      </div>
      <div class="col-md-6 text-center p-3">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">{% endif %}
      </div>
    </div>
    <div class="px-3 pb-3">
      {% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
      <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
      <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a>
    </div>
  </div>

  {% elif v == 5 %}
  <div class="card shadow border-0">
    <div class="row no-gutters align-items-center">
      <div class="col-md-3 text-center p-3">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid img-thumbnail" style="max-height:260px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid img-thumbnail" style="max-height:260px; object-fit:contain;">{% endif %}
      </div>
      <div class="col-md-9 p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h2 class="mb-0">{{ movie.name }}</h2>
          <span class="badge badge-dark">{{ movie.year }}</span>
        </div>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <p class="mb-2 text-muted">{{ movie.desc }}</p>
        <div class="mb-1 text-muted"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div>
        <div class="text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</div>
        <div class="mt-2">
          {% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a>
        </div>
      </div>
    </div>
  </div>

  {% elif v == 6 %}
  <div class="card shadow border-0">
    <div class="row no-gutters">
      <div class="col-md-6 p-3">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid rounded" style="max-height:340px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded" style="max-height:340px; object-fit:contain;">{% endif %}
      </div>
      <div class="col-md-6 p-3">
        <h2>{{ movie.name }}</h2>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <p>{{ movie.desc }}</p>
        <div class="row">
          <div class="col-6 text-muted"><strong>Year:</strong> {{ movie.year }}</div>
          <div class="col-6 text-muted"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div>
          <div class="col-6 text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</div>
          <div class="col-6 text-muted"><strong>Rating:</strong> {{ movie.rating|default:0|floatformat:"1" }}/5</div>
        </div>
        <div class="mt-2">
          {% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a>
        </div>
      </div>
    </div>
  </div>

  {% elif v == 7 %}
  <div class="card shadow border-0">
    <div class="row no-gutters">
      <div class="col-md-8 p-3">
        <h2 class="mb-1">{{ movie.name }}</h2>
        <span class="badge badge-primary mb-2">{{ movie.year }}</span>
        <p class="mb-2">{{ movie.desc }}</p>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <div class="text-muted mb-2"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div>
        <div class="text-muted mb-2"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</div>
        <div>{% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a></div>
      </div>
      <div class="col-md-4 p-3 text-center">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid img-thumbnail" style="max-height:300px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid img-thumbnail" style="max-height:300px; object-fit:contain;">{% endif %}
      </div>
    </div>
  </div>

  {% elif v == 8 %}
  <div class="card shadow border-0">
    <div class="row no-gutters align-items-center">
      <div class="col-md-6 p-3 text-center">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">{% endif %}
      </div>
      <div class="col-md-6 p-3">
        <h2>{{ movie.name }}</h2>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <div class="row">
          <div class="col-6 text-muted"><strong>Year:</strong> {{ movie.year }}</div>
          <div class="col-6 text-muted"><strong>Rating:</strong> {{ movie.rating|default:0|floatformat:"1" }}/5</div>
          <div class="col-6 text-muted"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div>
          <div class="col-6 text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</div>
        </div>
        <p class="mt-2">{{ movie.desc }}</p>
        <div>{% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a></div>
      </div>
    </div>
  </div>

  {% elif v == 9 %}
  <div class="card shadow border-0">
    <div class="row no-gutters">
      <div class="col-md-12 p-3">
        <div class="text-center mb-3">
          {% if movie.img %}
          <img src="{{ movie.img.url }}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">
          {% else %}
          <img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded" style="max-height:320px; object-fit:contain;">
          {% endif %}
        </div>
        <h2 class="mb-1">{{ movie.name }}</h2>
        <span class="badge badge-primary mb-2">{{ movie.year }}</span>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <div class="row mb-2"><div class="col-6 text-muted"><strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div><div class="col-6 text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %}</div></div>
        <p>{{ movie.desc }}</p>
        <div class="text-right">{% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a></div>
      </div>
    </div>
  </div>

  {% else %}
  <div class="card shadow border-0">
    <div class="row no-gutters align-items-center">
      <div class="col-md-6 p-3">
        <h2>{{ movie.name }}</h2>
        <p class="mb-2 text-muted">{{ movie.desc }}</p>
        <div class="mb-2">{% for genre in movie.genres.all %}<span class="badge badge-secondary mr-1">{{ genre.name }}</span>{% endfor %}</div>
        <div class="mb-2 text-muted"><strong>Year:</strong> {{ movie.year }} &nbsp; <strong>Director:</strong> {{ movie.director|default:"Not specified" }}</div>
        <div class="mb-2 text-muted"><strong>Duration:</strong> {% if movie.duration %}{{ movie.duration }} min{% else %}Not specified{% endif %} &nbsp; <strong>Rating:</strong> {{ movie.rating|default:0|floatformat:"1" }}/5</div>
        <div class="mt-1">{% if movie.trailer_url %}<a class="btn btn-primary btn-sm mr-2" target="_blank" href="{{ movie.trailer_url }}">Trailer</a>{% endif %}
          <a class="btn btn-warning btn-sm mr-2" href="{% url 'movieapp:update' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Edit</a>
          <a class="btn btn-danger btn-sm" href="{% url 'movieapp:delete' movie.id %}{% if DYNAMIC_HTML_ENABLED %}?seed={{ INITIAL_SEED }}{% endif %}">Delete</a></div>
      </div>
      <div class="col-md-6 text-center p-3">
        {% if movie.img %}<img src="{{ movie.img.url }}" class="img-fluid rounded" style="max-height:340px; object-fit:contain;">{% else %}<img src="{% static 'images/placeholder.jpg' %}" class="img-fluid rounded" style="max-height:340px; object-fit:contain;">{% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  {# Comments section (kept constant) #}
  <div class="card mt-4 shadow">
    <div class="card-header bg-light"><h4 class="mb-0"><i class="fas fa-comments mr-2"></i>Comments ({{ comments.count }})</h4></div>
    <div class="card-body" data-dynamic-group="detail-comments">
      <form id="comment-form" method="POST" action="{% url 'movieapp:add_comment' movie.id %}">{% csrf_token %}
        <div class="form-group"><input type="text" name="name" class="form-control mb-2" placeholder="Your name" required><textarea name="content" class="form-control" rows="3" placeholder="Write a comment..." required></textarea></div>
        <button type="submit" class="btn btn-primary">Submit comment</button>
      </form>
      <div class="comment-list mt-4" id="comments-container" data-dynamic-group="comments-list">
        {% for comment in comments %}
        <div class="media mb-3 p-3 {% if not forloop.last %}border-bottom{% endif %}">
          <div class="mr-3"><i class="fas fa-user-circle fa-2x text-secondary"></i></div>
          <div class="media-body"><h5 class="mt-0">{{ comment.name }} <small class="text-muted ml-2">{{ comment.created_at|timesince }} ago</small></h5><p>{{ comment.content }}</p></div>
        </div>
        {% empty %}
        <div class="text-center py-4" id="no-comments"><p class="text-muted">No comments yet. Be the first to comment!</p></div>
        {% endfor %}
      </div>
    </div>
  </div>

  {# Related movies grid (reuse card variants) #}
  {% if related_movies %}
  <div class="mt-5">
    <h3 class="mb-4">Related Movies</h3>
    <div class="row" data-dynamic-group="related-grid">
      {% for related in related_movies %}
      {% include "partials/card/variants.html" with movie=related %}
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>
{% endwith %}


